C51 COMPILER V7.10   YDLCD                                                                 03/29/2009 20:15:57 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE YDLCD
OBJECT MODULE PLACED IN ydLCD.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ydLCD.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          /********************************************************************************
   3          
   4          *  描述:                LCD1602 移动显示                                       *
   5          * 显示方式：                                                                   *
   6          * 1、LCD第一行显示： BIG BIG WORLD                                             *
   7          *      LCD第二行显示：I LOVE PUZHONG                                           *
   8          * 2、先将两行字符写入DDRAM中，然后从右至左逐字移出显示。                       *
   9          * 3、在指定位置停留1.6秒后，闪烁2次，清屏。                                    *
  10          * 4、反复循环上述显示方式。                                                    *                          
             -  
  11          ********************************************************************************/
  12          
  13          #include <reg51.h>
  14          #include <intrins.h>                                                                  
  15                                                                                     
  16          #define uchar unsigned char                                                
  17          #define uint unsigned int                                                  
  18                                                                                     
  19          sbit LCD_RS = P2^6;                                                        
  20          sbit LCD_RW = P2^5;                                                        
  21          sbit LCD_EN = P2^7;                                                        
  22                                                                                     
  23          uchar code dis1[] = {"BIG BIG WORLD"};                                  
  24          uchar code dis2[] = {"I LOVE PUZHONG"};                                  
  25                                                                                     
  26                                                                                     
  27          /*******************************************************************/      
  28          /*                                                                         
  29          /* 延时子程序                                                              
  30          /*                                                                         
  31          /*******************************************************************/      
  32                                                                                     
  33          void delay(int ms)                                                         
  34          {                                                                          
  35   1         int i;                                                                  
  36   1         while(ms--)                                                             
  37   1         {                                                                       
  38   2           for(i = 0; i< 250; i++)                                               
  39   2           {                                                                     
  40   3            _nop_();                                                             
  41   3            _nop_();                                                             
  42   3            _nop_();                                                             
  43   3            _nop_();                                                             
  44   3           }                                                                     
  45   2         }                                                                       
  46   1      }                                                                          
  47                                                                                     
  48          /*******************************************************************/      
  49          /*                                                                         
  50          /*检查LCD忙状态                                                            
  51          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。              
  52          /*                                                                         
  53          /*******************************************************************/      
  54                                                                                     
C51 COMPILER V7.10   YDLCD                                                                 03/29/2009 20:15:57 PAGE 2   

  55          bit lcd_busy()                                                             
  56          {                                                                          
  57   1          bit result;                                                            
  58   1          LCD_RS = 0;                                                            
  59   1          LCD_RW = 1;                                                            
  60   1          LCD_EN = 1;                                                            
  61   1          _nop_();                                                               
  62   1          _nop_();                                                               
  63   1          _nop_();                                                               
  64   1          _nop_();                                                               
  65   1           result = (bit)(P0&0x80);                                              
  66   1          LCD_EN = 0;                                                            
  67   1          return result;                                                         
  68   1      }                                                                          
  69                                                                                     
  70          /*******************************************************************/      
  71          /*                                                                         
  72          /*写指令数据到LCD                                                          
  73          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                                     
  74          /*                                                                         
  75          /*******************************************************************/      
  76                                                                                     
  77          void lcd_wcmd(uchar cmd)                                                   
  78          {                                                                          
  79   1         while(lcd_busy());                                                      
  80   1          LCD_RS = 0;                                                            
  81   1          LCD_RW = 0;                                                            
  82   1          LCD_EN = 0;                                                            
  83   1          _nop_();                                                               
  84   1          _nop_();                                                               
  85   1          P0 = cmd;                                                              
  86   1          _nop_();                                                               
  87   1          _nop_();                                                               
  88   1          _nop_();                                                               
  89   1          _nop_();                                                               
  90   1          LCD_EN = 1;                                                            
  91   1          _nop_();                                                               
  92   1          _nop_();                                                               
  93   1          _nop_();                                                               
  94   1          _nop_();                                                               
  95   1          LCD_EN = 0;                                                            
  96   1      }                                                                          
  97                                                                                     
  98          /*******************************************************************/      
  99          /*                                                                         
 100          /*写显示数据到LCD                                                          
 101          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                                       
 102          /*                                                                         
 103          /*******************************************************************/      
 104                                                                                     
 105          void lcd_wdat(uchar dat)                                                   
 106          {                                                                          
 107   1         while(lcd_busy());                                                      
 108   1          LCD_RS = 1;                                                            
 109   1          LCD_RW = 0;                                                            
 110   1          LCD_EN = 0;                                                            
 111   1          P0 = dat;                                                              
 112   1          _nop_();                                                               
 113   1          _nop_();                                                               
 114   1          _nop_();                                                               
 115   1          _nop_();                                                               
 116   1          LCD_EN = 1;                                                            
C51 COMPILER V7.10   YDLCD                                                                 03/29/2009 20:15:57 PAGE 3   

 117   1          _nop_();                                                               
 118   1          _nop_();                                                               
 119   1          _nop_();                                                               
 120   1          _nop_();                                                               
 121   1          LCD_EN = 0;                                                            
 122   1      }                                                                          
 123                                                                                     
 124          /*******************************************************************/      
 125          /*                                                                         
 126          /*  设定显示位置                                                           
 127          /*                                                                         
 128          /*******************************************************************/      
 129                                                                                     
 130          void lcd_pos(uchar pos)                                                    
 131          {                                                                          
 132   1         lcd_wcmd(pos|0x80);      //数据指针=80+地址变量                         
 133   1      }                                                                          
 134                                                                                     
 135          /*******************************************************************/      
 136          /*                                                                         
 137          /*  LCD初始化设定                                                          
 138          /*                                                                         
 139          /*******************************************************************/      
 140                                                                                     
 141          void lcd_init()                                                            
 142          {                                                                          
 143   1          delay(15);                     //等待LCD电源稳定                       
 144   1          lcd_wcmd(0x38);          //16*2显示，5*7点阵，8位数据                  
 145   1          delay(5);                                                              
 146   1          lcd_wcmd(0x38);                                                        
 147   1          delay(5);                                                              
 148   1          lcd_wcmd(0x38);                                                        
 149   1          delay(5);                                                              
 150   1                                                                                 
 151   1          lcd_wcmd(0x0c);          //显示开，关光标                              
 152   1          delay(5);                                                              
 153   1          lcd_wcmd(0x06);          //移动光标                                    
 154   1          delay(5);                                                              
 155   1          lcd_wcmd(0x01);          //清除LCD的显示内容                           
 156   1          delay(5);                                                              
 157   1      }                                                                          
 158                                                                                     
 159          /*******************************************************************/      
 160          /*                                                                         
 161          /*  清屏子程序                                                             
 162          /*                                                                         
 163          /*******************************************************************/      
 164                                                                                     
 165          void lcd_clr()                                                             
 166          {                                                                          
 167   1          lcd_wcmd(0x01);          //清除LCD的显示内容                           
 168   1          delay(5);                                                              
 169   1      }                                                                          
 170                                                                                     
 171          /*******************************************************************/      
 172          /*                                                                         
 173          /*  闪动子程序                                                             
 174          /*                                                                         
 175          /*******************************************************************/      
 176                                                                                     
 177          void flash()                                                               
 178          {                                                                          
C51 COMPILER V7.10   YDLCD                                                                 03/29/2009 20:15:57 PAGE 4   

 179   1          delay(600);                     //控制停留时间                         
 180   1          lcd_wcmd(0x08);            //关闭显示                                  
 181   1          delay(200);                    //延时                                  
 182   1          lcd_wcmd(0x0c);            //开显示                                    
 183   1          delay(200);                                                            
 184   1          lcd_wcmd(0x08);            //关闭显示                                  
 185   1          delay(200);                     //延时                                 
 186   1          lcd_wcmd(0x0c);            //开显示                                    
 187   1          delay(200);                                                            
 188   1      }                                                                          
 189                                                                                     
 190          /*******************************************************************/      
 191          /*                                                                         
 192          /*  主程序                                                                 
 193          /*                                                                         
 194          /*******************************************************************/      
 195                                                                                     
 196          main()                                                                     
 197          {                                                                          
 198   1          uchar i,j;                                                             
 199   1          delay(10);                                                             
 200   1          lcd_init();                          //初始化LCD                       
 201   1                                                                                 
 202   1          while(1)                                                               
 203   1         {                                                                       
 204   2            lcd_clr();                                                           
 205   2                                                                                 
 206   2            lcd_pos(0x10);               //设置显示位置为第一行第17列            
 207   2            i = 0;                                                               
 208   2                                                                                 
 209   2           while(dis1[i] != '\0')                                                
 210   2           {                                      //显示字符"         "   
 211   3             lcd_wdat(dis1[i]);                                                  
 212   3             i++;                                                                
 213   3           }                                                                     
 214   2                                                                                 
 215   2            lcd_pos(0x50);              //设置显示位置为第二行第17列             
 216   2            i = 0;                                                               
 217   2                                                                                 
 218   2           while(dis2[i] != '\0')                                                
 219   2           {                                                                     
 220   3             lcd_wdat(dis2[i]);         //显示字符"        "             
 221   3             i++;                                                                
 222   3           }                                                                     
 223   2                                                                                 
 224   2           for(j=0;j<16;j++)           //向左移动16格                           
 225   2           {                                                                     
 226   3             lcd_wcmd(0x18);           //字符同时左移一格                        
 227   3             delay(100);                   //控制移动时间                        
 228   3           }                                                                     
 229   2                                                                                 
 230   2            flash();                            //闪动二次                       
 231   2                                                                                 
 232   2         }                                                                       
 233   1      }                                                                          
 234                                                                                     
 235                                                                                     
 236                                                                     
 237           


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V7.10   YDLCD                                                                 03/29/2009 20:15:57 PAGE 5   

   CODE SIZE        =    316    ----
   CONSTANT SIZE    =     29    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
